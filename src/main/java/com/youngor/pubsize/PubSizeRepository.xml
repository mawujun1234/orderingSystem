<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<!-- mawujun qq:16064988 e-mail:16064988@qq.com-->
<mapper namespace="com.youngor.pubsize.PubSizeRepository">
	<!-- 查询语句，会自动分页-->
	<sql id="queryPage_where">
		 where SIZETY=#{sizety}
    	<if test="sizeno!=null and sizeno!=''">
    		and sizeno like '%${sizeno}%'
    	</if>
    	<if test="sizenm!=null and sizenm!=''">
    		and sizenm like '%${sizenm}%'
    	</if>
    	<if test="sizest!=null and sizest!=''">
    		and sizest = #{sizest}
    	</if>
    	<if test="szbrad!=null and szbrad!=''">
    		and szbrad = #{szbrad}
    	</if>
    	<if test="szclno!=null and szclno!=''">
    		and szclno = #{szclno}
    	</if>
    	<if test="szsast!=null and szsast!=''">
    		and szsast = #{szsast}
    	</if>
	</sql>
    <select id="queryPage" resultType="com.youngor.pubsize.PubSizeVO" parameterType="map">
    	select * from ord_pub_size a
    	<include refid="queryPage_where"></include>
    	order by a.sizeso desc
    </select> 
     <!-- 名称模式为：****_count,也可以不写，但如果查询叫复杂的话，自己写有助于控制查询性能-->
    <select id="queryPage_count" resultType="int" parameterType="map">
    	select count(a.sizeno)
		from ord_pub_size a 
		<include refid="queryPage_where"></include>
    </select>
    
    <select id="queryStdsz4Sel" resultType="com.youngor.pubsize.PubSizeVO" parameterType="map">
    	select * from ord_pub_size a
    	<include refid="queryPage_where"></include>
    	and not exists(
    		select 1 from ord_pub_sizedtl b where a.sizeno=b.sizeno and a.sizety=b.sizety
    		and b.fszty=#{fszty} and b.fszno=#{fszno}
    	)
    	order by a.sizeso desc
    </select> 
     <!-- 名称模式为：****_count,也可以不写，但如果查询叫复杂的话，自己写有助于控制查询性能-->
    <select id="queryStdsz4Sel_count" resultType="int" parameterType="map">
    	select count(a.sizeno)
		from ord_pub_size a 
		<include refid="queryPage_where"></include>
		<if test="fszno!=null and fszno!=''">
		and not exists(
    		select 1 from ord_pub_sizedtl b where a.sizeno=b.sizeno and a.sizety=b.sizety
    		and b.fszty=#{fszty} and b.fszno=#{fszno}
    	)
    	</if>
    </select>
    
    <!-- 获取某个包装规格里的明细规格-->
    <select id="queryPrdpStdsz" resultType="com.youngor.pubsize.PubSizeDtlVO">
    	select a.*,b.sizenm from ord_pub_sizedtl a,ord_pub_size b 
    	where a.sizety=b.sizety and a.sizeno=b.sizeno
    	and a.fszty=#{fszty} and a.fszno=#{fszno} and b.sizety='STDSZ'
    </select>
    
    <!-- 获取所有的品牌和大类组合-->
     <select id="querySizegpBradnoSpclno" resultType="map">
     	select brad.itno as bradno,brad.itnm as bradno_name
		,cls.itno as spclno,cls.itnm as spclno_name
		 from ord_pub_code brad,ord_pub_code cls
		 where brad.tyno=1 and cls.tyno=0
		 <if test="bradno!=null and bradno!=''">
		 	 and brad.itno=#{bradno}
		 </if>
		  <if test="spclno!=null and spclno!=''">
		 	 and cls.itno=#{spclno}
		 </if>
		
     </select>
     
     
    <!-- 获取某个规格池中的所有(单规，包赚高规格)-->
    <select id="querySizegp" resultType="com.youngor.pubsize.PubSizeDtlVO">
    	select a.*,b.sizenm from ord_pub_sizedtl a,ord_pub_size b 
    	where a.sizety=b.sizety and a.sizeno=b.sizeno
    	and a.fszty=#{fszty} and a.fszno=#{fszno} and b.sizety=#{sizety} 
    </select>
     <!-- 获取某个规格池中的所有(包装规格)
    <select id="querySizegpPrdpk" resultType="com.youngor.pubsize.PubSizeDtlVO">
    	select a.*,b.sizenm from ord_pub_sizedtl a,ord_pub_size b 
    	where a.sizety=b.sizety and a.sizeno=b.sizeno
    	and a.fszty=#{fszty} and a.fszno=#{fszno} and b.sizety='PRDPK' 
    </select>-->
    
     <select id="queryPrdszty" resultType="com.youngor.pubsize.PubSizeDtlVO">
    	select a.*,b.sizenm from ord_pub_sizedtl a,ord_pub_size b 
    	where a.sizety=b.sizety and a.sizeno=b.sizeno
    	and a.fszty=#{fszty} and a.fszno=#{fszno} and b.sizety=#{sizety} 
    </select>
    
    <!--  获取这次订货会用到的规格范围 -->
    <select id="queryPRDSZTY4Ordmt" resultType="com.youngor.pubsize.PubSizeVO" parameterType="map">
    	select distinct a.* from ord_pub_size a
    	where 
    	a.sizety='PRDSZTY' and a.szbrad=#{szbrad} and a.szclno=#{szclno} and a.sizest=1
    	and exists (select 1 from ord_sample_design c,ord_sample_plan d,ord_sample_design_sizegp e where c.sampno=e.sampno and c.plspno=d.plspno  and a.sizeno=e.sizegp and d.ormtno=#{ormtno})
    	order by a.sizeso
    </select> 
</mapper>

