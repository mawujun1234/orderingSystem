<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<!-- mawujun qq:16064988 e-mail:16064988@qq.com-->
<mapper namespace="com.youngor.order.OrdRepository">
	<!-- 查询语句，会自动分页-->
    <select id="queryPage" resultType="com.youngor.order.Ord" parameterType="map">
    	select * from ord_ord
    </select> 
     <!-- 名称模式为：****_count,也可以不写，但如果查询叫复杂的话，自己写有助于控制查询性能-->
    <select id="queryPage_count" resultType="int" parameterType="map">
    	select count(a.id)
		from ord_ord a
    </select>
    
     <select id="haveOrd" resultType="com.youngor.order.Ord" parameterType="com.youngor.order.Ord">
     	select * from ORD_ORD
       where ormtno=#{ormtno} and ortyno=#{ortyno} and ordorg=#{ordorg}
     </select>
     <!--
     <parameterMap type="map" id="order_dl__order_can_params">  
	   <parameter property="P_ORMTNO" jdbcType="VARCHAR" mode="IN"/>   
	   <parameter property="P_ORDORG" jdbcType="VARCHAR" mode="IN"/>   
	   <parameter property="P_SAMPNO" jdbcType="VARCHAR" mode="IN"/>  
	   <parameter property="W_NUM" jdbcType="INTEGER" mode="OUT"/>   
	 </parameterMap>  
	 <update id="order_dl__order_can" parameterMap="order_dl__order_can_params" statementType="CALLABLE">  
       {call ORDER_DL.ORDER_CAN(?,?,?)}  
    </update>
    -->
    
    <select id="order_dl__order_can" parameterType="map" resultType="int">
    	select ORDER_DL.ORDER_CAN(#{P_ORMTNO},#{P_ORDORG},#{P_SAMPNO}) from dual
    </select>

     <!--移动端扫描，获取样衣的信息 -->
     <select id="querySample" resultType="com.youngor.order.SampleVO" parameterType="map">
     	 select a.plspno,a.plspnm,b.sampno,b.sampnm,
	     b.versno,a.spseno,a.spftpr,a.sprtpr,a.spbseno,a.sprseno,a.splcno,a.spbano,
	     a.spclno,a.sptyno,a.bradno,b.sexno,b.suitty,b.spltmk,b.abstat
	     from ord_sample_plan a,ord_sample_design b
	     where a.plspno=b.plspno and lower(b.sampnm)=lower(#{sampnm}) and a.ormtno=#{ormtno}
	     and b.sampst=1 and a.plstat=1
     </select>
     
     <select id="querySampleDesignStpr" resultType="com.youngor.sample.SampleDesignStpr" parameterType="map">
     	 select a.* from ord_sample_design_stpr a
     	 where  a.sampno=#{sampno}
     </select>
     
     
     <resultMap id="querySuitVO_mapper" type="com.youngor.order.SuitVO" >  
        <id column="suitno" property="suitno"/>  
        <result column="spftpr" property="spftpr"/> 
        <result column="sprtpr" property="sprtpr"/> 
        <result column="sampno" property="sampno"/> 
        <collection property="sizeVOs" ofType="com.youngor.order.SizeVO">  
            <id column="sizeno" property="sizeno"/>  
            <result column="sizety" property="sizety"/>
            <result column="sizenm" property="sizenm"/>  
            <result column="szrate" property="szrate"/> 
            <result column="orszqt" property="orszqt"/> 
        </collection>  
          
    </resultMap>  
     <!--查询不是套西之外的小类，即表中套中拥有的规格 -->
     <select id="querySuitVO_T00" resultMap="querySuitVO_mapper" parameterType="com.youngor.order.SampleVO">
     	select a.*,nvl(b.szrate,1) szrate,c.orszqt from (
     	  SELECT '${sampno}' AS sampno,c.suitno,c.sizegp,a.sizeno,a.sizenm,a.sizety FROM ORD_PUB_SIZE a,ord_pub_sizedtl b,ord_sample_design_sizegp c  
	      where a.sizety=b.sizety and a.sizeno=b.sizeno and b.fszno=c.sizegp and  b.fszty='PRDSZTY'
	      and  c.sampno=#{sampno}
	      and a.sizety='STDSZ' and b.sizety='STDSZ'  
	    ) a left join (
	    	select * from    ORD_ORD_SZRT
            where ormtno=#{ormtno} and ordorg=#{ordorg} and bradno=#{bradno} and spclno=#{spclno} and spseno=#{spseno} and versno=#{versno}
             and sizety='STDSZ'
	    ) b
	    on a.sizegp=b.sizegp and a.sizeno=b.sizeno
	    left join (<!-- 获取已经定了的数量-->
	    	select * from ord_ordszdtl where mtorno=#{mtorno} and sampno=#{sampno} and sizety='STDSZ'
	    ) c on a.sampno=c.sampno and a.suitno=c.suitno and a.sizeno=c.sizeno
	    order by a.suitno,a.sizeno
     </select>
     <!-- 当上报方式为  包装箱的时候  包装箱只显示标准箱(即单规箱)-->
     <select id="querySuitVO_PRDPK" resultMap="querySuitVO_mapper" parameterType="com.youngor.order.SampleVO">
     	select a.*,'1' as szrate,c.orszqt from (
     	  SELECT '${sampno}' AS sampno,c.suitno,c.sizegp,a.sizeno,a.sizenm,a.sizety FROM ORD_PUB_SIZE a,ord_pub_sizedtl b,ord_sample_design_sizegp c  
	      where a.sizety=b.sizety and a.sizeno=b.sizeno and b.fszno=c.sizegp and  b.fszty='PRDSZTY'
	      and NVL(a.SIZETY1,1)=1
	      and  c.sampno=#{sampno}
	      and a.sizety='PRDPK' and b.sizety='PRDPK'  
	    ) a 
	    left join (<!-- 获取已经定了的数量-->
	    	select * from ord_ordszdtl where mtorno=#{mtorno} and sampno=#{sampno} and sizety='PRDPK'
	    ) c on a.sampno=c.sampno and a.suitno=c.suitno and a.sizeno=c.sizeno
	    order by a.suitno,a.sizeno
     </select>
     
     <!--当小类是套西的时候，需要从套装种类中选取相应的规格范围，在pc的时候是标准的套装种类，但是在移动端还要通过ORD_SUIT_DC进行过滤-->
     <select id="querySuitVO" resultMap="querySuitVO_mapper" parameterType="com.youngor.order.SampleVO">
     	select a.*,nvl(b.szrate,1) szrate,c.orszqt from (
     	  SELECT '${sampno}' AS sampno,c.suitno,c.sizegp,a.sizeno,a.sizenm,a.sizety FROM ORD_PUB_SIZE a,ord_pub_sizedtl b,ord_sample_design_sizegp c  
	      where a.sizety=b.sizety and a.sizeno=b.sizeno and b.fszno=c.sizegp and  b.fszty='PRDSZTY'
	      and  c.sampno=#{sampno}
	      and a.sizety='STDSZ' and b.sizety='STDSZ'  
	      and exists (select 1 from ORD_SUIT_DC bb where c.suitno=bb.suitno 
	          and bb.sptyno=#{sptyno} and bb.sexno=#{sexno}  and  bb.suitty=#{suitty} and bb.spltmk=#{spltmk} and bb.bradno=#{bradno}
	        )
	     ) a left join (
	    	select * from    ORD_ORD_SZRT
            where ormtno=#{ormtno} and ordorg=#{ordorg} and bradno=#{bradno} and spclno=#{spclno} and spseno=#{spseno} and versno=#{versno}
             and sizety='STDSZ'
	    ) b
	    on a.sizegp=b.sizegp and a.sizeno=b.sizeno
	    left join (<!-- 获取已经定了的数量-->
	    	select * from ord_ordszdtl where mtorno=#{mtorno} and sampno=#{sampno} and sizety='STDSZ'
	    ) c on a.sampno=c.sampno and a.suitno=c.suitno and a.sizeno=c.sizeno
	    order by a.suitno,a.sizeno
     </select>
     <!-- 移动端进行清零按钮的时候 -->
     <delete id="clearOrddtl" parameterType="map">
     	delete ord_orddtl where mtorno=#{mtorno} and sampno=#{sampno}
     </delete>
     <delete id="clearOrdszdtl" parameterType="map">
     	delete ord_ordszdtl where mtorno=#{mtorno} and sampno=#{sampno}
     </delete>
     
     
     <!-- 查询这个订货单元可以使用的订货时间 -->
     <select id="get_ordmt_scde" resultType="com.youngor.ordmt.OrdmtScde" parameterType="map">
     	select * from ORD_ORDMT_SCDE where ormtno=#{ormtno} and channo=#{channo}
     </select>
     
     <!-- 本次订货的一些统计信息
     <select id="queryMyInfoVO" resultType="com.youngor.order.MyInfoVO" parameterType="map">
     	select sum(a.ormtqt)ormtqt_count,sum(a.ormtqs) ormtqs_count,count(distinct c.spseno) spseno_count,count(distinct c.spclno) spclno_count,count(distinct a.sampno) sampno_count 
         from ORD_ORDDTL a,ord_sample_design b,ord_sample_plan c
         where a.sampno=b.sampno and b.plspno=c.plspno
         and a.mtorno=#{mtorno}  
     </select>-->
     <select id="queryMyInfoVO" resultType="com.youngor.order.MyInfoVO" parameterType="map">
     	select sum(a.ormtqt)ormtqt
     	<if test="channo=='TX'">
     		,sum(a.ormtqt*c.spftpr) ormtam
     	</if>
     	<if test="channo!='TX'">
     		,sum(a.ormtqt*c.sprtpr) ormtam
     	</if>
         from ORD_ORDDTL a,ord_sample_design b,ord_sample_plan c
         where a.sampno=b.sampno and b.plspno=c.plspno
         and a.mtorno=#{mtorno}  
     </select>
     <!-- 检查必定款是否已经全订 -->
     <select id="query_none_abstat" resultType="com.youngor.sample.SampleDesign" parameterType="map">
     	select a.* from ord_sample_design a,ORD_SAMPLE_PLAN b where a.PLSPNO=b.PLSPNO and b.ORMTNO=#{ormtno}
     	and abstat='1' and not exists (
     		select 1 from ORD_ORDDTL c where a.sampno=c.sampno and c.mtorno=#{mtorno}
     	)
     </select>
     <!-- 生成版本订单号和版本号 -->
     <update id="updateMtornoMlorvn" parameterType="map">
     	  update ord_orddtl a set ORMTQS=ORMTQT,mlorvn=1,mlorno=(select mlorno from (
           select a.mtorno,a.sampno,a.suitno,a.mtorno||c.bradno||spclno as mlorno 
           from ord_orddtl a,ord_sample_design b,ord_sample_plan c
           where a.sampno=b.sampno and b.plspno=c.plspno and a.mtorno=#{mtorno}
           ) b where a.mtorno=b.mtorno and a.sampno=b.sampno and a.suitno=b.suitno
          ) 
          where a.mtorno=#{mtorno}
     </update>
     <!-- 拷贝订单明细表中的确认数量->原始数量,同时设置确认数量为0 
     <update id="updateOrmtqtZeor" parameterType="map">
     	 update ord_orddtl a set ORMTQT=0 where  a.mtorno=#{mtorno}
     </update>-->
     <!-- 创建订单副表  -->
     <insert id="createOrd_ordhd" parameterType="map">
     	   insert into ORD_ORDHD(mtorno,mlorno,MLORVN,BRADNO,SPCLNO,SDTYNO,ORSTAT,SZSTAT,ISFECT) 
       select distinct a.mtorno,a.mlorno ,a.MLORVN,c.BRADNO,c.SPCLNO,10,0,0,1
           from ord_orddtl a,ord_sample_design b,ord_sample_plan c
           where a.sampno=b.sampno and b.plspno=c.plspno and a.mtorno=#{mtorno}
     </insert>
     <!-- 创建订单副表的历史表 -->
     <insert id="createOrd_ordhd_his" parameterType="map">
     	 insert into Ord_ordhd_his
 		 select * from Ord_ordhd where mtorno=#{mtorno}
     </insert>
      <!-- 创建订单明细表的历史表 -->
     <insert id="createOrd_orddtl_his" parameterType="map">
     	 insert into Ord_orddtl_his
 		select * from Ord_orddtl where mtorno=#{mtorno}
     </insert>
     <!-- 更新订单的节点类型未“区域平衡”-->
     <update id="update_ordhd_SDTYNO">
     	update ORD_ORDHD set SDTYNO=20 where mtorno=#{mtorno} and SDTYNO=10
     </update>
     <!-- 更新规格明细表的版本订单号-->
     <update id="update_ord_ordszdtl_MLORNO">
     	update ORD_ORDSZDTL a set MLORNO =
		(select distinct MLORNO from ORD_ORDDTL b 
		where a.MTORNO=b.MTORNO and a.SAMPNO=b.SAMPNO and b.mtorno=#{mtorno})
     </update>
     
     <select id="check_is_confirm" resultType="string" parameterType="map">
     	select distinct SDTYNO  from ORD_ORDHD where mtorno=#{mtorno}
     </select>
     <!-- 
     <select id="queryOrdorg" parameterType="map" resultType="com.youngor.org.Org">
     	select b.* from ORD_ORD a,t_org b
      	where a.ORDORG=b.orgno  
      	<if test="channo!=null and channo!=''">
			and a.channo=#{channo}
		</if>
		<if test="ormtno!=null and ormtno!=''">
			 and a.ormtno=#{ormtno}
		</if>
		<if test="ortyno!=null and ortyno!=''">
			and a.ortyno=#{ortyno}
		</if>
     </select>
     -->
     <select id="queryOrdorg" parameterType="map" resultType="com.youngor.org.Org">
     	select b.* from ORD_ORD a,V_ORD_ORG b
      	where a.ORDORG=b.orgno  
      	<if test="channo!=null and channo!=''">
			and a.channo=#{channo}
		</if>
		<if test="ormtno!=null and ormtno!=''">
			 and a.ormtno=#{ormtno}
		</if>
		<if test="ortyno!=null and ortyno!=''">
			and a.ortyno=#{ortyno}
		</if>
		<if test="qyno!=null and qyno!=''">
			and b.qyno=#{qyno}
		</if>
     </select>
     
     <sql id="queryQyVO_where">
     	<where>
			a.ormtno=#{ormtno} 
			<if test="ortyno!=null and ortyno!=''">
				and a.ortyno=#{ortyno} 
			</if>
			<if test="channo!=null and channo!=''">
				and a.channo=#{channo} 
			</if>
			<if test="ordorg!=null and ordorg!=''">
				and a.ordorg=#{ordorg} 
			</if>
			and g.yxgsno=#{yxgsno} and g.qyno=#{qyno}
			<if test="suitno!=null and suitno!=''">
				and c.suitno='#{suitno} 
			</if>		
			and b.sdtyno='20' 
			<if test="orstat!=null and orstat!=''">
				and b.orstat=#{orstat}
			</if>
			and e.bradno=#{bradno} and e.spclno=#{spclno} 
			<if test="sptyno!=null and sptyno!=''">
				and e.sptyno=#{sptyno}
			</if>
			<if test="spseno!=null and spseno!=''">
				and e.spseno=#{spseno}
			</if> 
			<if test="sampnm!=null and sampnm!=''">
				and d.sampnm like '%${sampnm}%'
			</if> 
			
     	</where>
     </sql>
     <select id="queryQyVO" parameterType="map" resultType="com.youngor.order.QyVO" >
     	SELECT c.mtorno,b.orstat,a.channo,a.ordorg,g.orgnm as ordorg_name,e.SPCLNO,e.SPTYNO,e.SPSENO,e.plspno,e.plspnm,d.sampno,d.sampnm,d.packqt,c.suitno,c.ormtqs,c.ormtqt
		,f.spftpr,f.sprtpr
		FROM ORD_ORD A
		INNER JOIN V_ORD_ORG G ON A.ORDORG=G.ORGNO
		INNER JOIN ORD_ORDDTL C ON A.MTORNO=C.MTORNO 
		INNER JOIN ORD_ORDHD B ON A.MTORNO=B.MTORNO AND B.MLORNO=C.MLORNO AND B.MLORVN=C.MLORVN
		INNER JOIN ORD_SAMPLE_DESIGN D ON C.SAMPNO=D.SAMPNO
		INNER JOIN ORD_SAMPLE_PLAN E ON D.PLSPNO=E.PLSPNO AND A.ORMTNO=E.ORMTNO
		inner join ORD_SAMPLE_DESIGN_STPR f on c.sampno=f.sampno and c.suitno=f.suitno
		<include refid="queryQyVO_where"></include> 
     </select>
     
      <select id="reloadTotal" parameterType="map" resultType="com.youngor.order.ReloadTotal">
      	SELECT sum(ormtqs) ormtqs,sum(decode(c.suitno,'T01',0.75,'T02',0.25,'T04',0.25,1)*ormtqs) ormtqs_zhes,
      	sum(ormtqt) ormtqt,sum(decode(c.suitno,'T01',0.75,'T02',0.25,'T04',0.25,1)*ormtqt) ormtqt_zhes,
      	SUM(F.spftpr*ormtqt) spftpr_jine,SUM(f.sprtpr*ormtqt) sprtpr_jine
		FROM ORD_ORD A
		INNER JOIN V_ORD_ORG G ON A.ORDORG=G.ORGNO
		INNER JOIN ORD_ORDDTL C ON A.MTORNO=C.MTORNO 
		INNER JOIN ORD_ORDHD B ON A.MTORNO=B.MTORNO AND B.MLORNO=C.MLORNO AND B.MLORVN=C.MLORVN
		INNER JOIN ORD_SAMPLE_DESIGN D ON C.SAMPNO=D.SAMPNO
		INNER JOIN ORD_SAMPLE_PLAN E ON D.PLSPNO=E.PLSPNO AND A.ORMTNO=E.ORMTNO
		inner join ORD_SAMPLE_DESIGN_STPR f on c.sampno=f.sampno and c.suitno=f.suitno
		<include refid="queryQyVO_where"></include> 
      </select>
     
     
     <update id="updateOrmtqt" parameterType="map"  >
     	update ORD_ORDDTL set ormtqt=#{ormtqt} where mtorno=#{mtorno} and sampno=#{sampno} and suitno=#{suitno}
     </update>
     
     <select id="querySuitBySampnm" resultType="com.youngor.order.QyNewFormVO"  parameterType="map"  >
     	  select distinct c.* from  ord_sample_plan a,ord_sample_design b,ord_sample_design_sizegp c
          where a.plspno=b.plspno and b.sampno=c.sampno
          and a.ormtno=#{ormtno} and b.sampnm=#{sampnm}
     </select>
     
     <!--判断某个样衣编号是否已经订过了 -->
     <select id="checkSampnoOrded" resultType="int"  parameterType="map"  >
     	  select count(*) from ord_orddtl a
          where a.sampno=#{sampno}
          and exists (select 1 from ord_ord b where a.mtorno=b.mtorno
              and b.ormtno=#{ormtno} and b.ortyno=#{ortyno} and b.ordorg=#{ordorg} and b.channo=#{channo} 
          )
     </select>
     <!-- 为了 获取审批订单号，审批版本号 -->
      <select id="getOrdhd" resultType="com.youngor.order.Ordhd"  parameterType="map"  >
     	   select a.* from ORD_ORDHD a,ord_sample_plan b,ord_sample_design c
          where a.bradno=b.bradno and a.SPCLNO=b.SPCLNO and b.plspno=c.plspno
          and c.sampno=#{sampno}
          and exists (select 1 from ORD_ORD b where a.MTORNO=b.MTORNO
              and b.ormtno=#{ormtno} and b.ortyno=#{ortyno} and b.ordorg=#{ordorg} and b.channo=#{channo} and ortyno='DZ'
          )
     </select>
     <!-- 提交指定的订货单位-->
     <update id="updateApprove_org" parameterType="map"  >
     	update ord_ordhd a set a.orstat=1 where (a.orstat=0 or a.orstat=4)
        and a.bradno=#{bradno} and a.spclno=#{spclno}
        and exists (select 1 from ord_ord b where a.mtorno=b.mtorno and b.ormtno=#{ormtno} and b.ordorg=#{ordorg} and ortyno='DZ')
     </update>
     
     
     <select id="queryZgsVO" resultType="map" parameterType="map">
     	SELECT P.PALTPY,DECODE(M.SDTYNO,0,'总公司平衡','非总公司平衡')SDTYNO,DECODE(M.ORSTAT,0,'编辑中','平衡完成')ORSTAT,
		       M.SPTYNM,M.SPSENM,M.SAMPNO,M.SAMPNM,M.ORMTQS00,M.ORMTQS01,M.ORMTQS02,M.ORMTQS04,
		       M.ORMTQT00,M.ORMTQT01,M.ORMTQT02,M.ORMTQT04,P1.SAMPNM PLSPNM
		 FROM
		(SELECT A.ORMTNO,SUM(DECODE(B.SDTYNO,'30',0,1))SDTYNO,SUM(DECODE(B.ORSTAT,0,0,4,0,1))ORSTAT,
		   E1.ITNM AS SPTYNM,E2.ITNM AS SPSENM,D.SAMPNO,D.SAMPNM,
		   DECODE(C.SUITNO,'T00',SUM(C.ORMTQS),0)ORMTQS00,DECODE(C.SUITNO,'T01',SUM(C.ORMTQS),0)ORMTQS01,
		   DECODE(C.SUITNO,'T02',SUM(C.ORMTQS),0)ORMTQS02,DECODE(C.SUITNO,'T04',SUM(C.ORMTQS),0)ORMTQS04,
		   DECODE(C.SUITNO,'T00',SUM(C.ORMTQT),0)ORMTQT00,DECODE(C.SUITNO,'T01',SUM(C.ORMTQT),0)ORMTQT01,
		   DECODE(C.SUITNO,'T02',SUM(C.ORMTQT),0)ORMTQT02,DECODE(C.SUITNO,'T04',SUM(C.ORMTQT),0)ORMTQT04
		 FROM ORD_ORD A
		INNER JOIN ORD_ORDDTL C ON A.MTORNO=C.MTORNO 
		LEFT JOIN ORD_ORDHD B ON A.MTORNO=B.MTORNO AND B.MLORNO=C.MLORNO AND B.MLORVN=C.MLORVN
		INNER JOIN ORD_SAMPLE_DESIGN D ON C.SAMPNO=D.SAMPNO
		INNER JOIN ORD_SAMPLE_PLAN E ON D.PLSPNO=E.PLSPNO AND A.ORMTNO=E.ORMTNO
		INNER JOIN ORD_PUB_CODE E1 ON E1.TYNO='2' AND E1.FITNO=E.SPCLNO AND E1.ITNO=E.SPTYNO
		INNER JOIN ORD_PUB_CODE E2 ON E2.TYNO='5' AND E2.FITNO=E.SPCLNO AND E2.ITNO=E.SPSENO
		WHERE
		A.ORMTNO=#{ormtno} AND A.ORTYNO='DZ' 
		AND E.BRADNO=#{bradno}  AND E.SPCLNO=#{spclno}
		<if test="sptyno!=null and sptyno!=''">
			 and e.sptyno=#{sptyno}
		</if>
		<if test="spseno!=null and spseno!=''">
			and e.spseno=#{spseno}
		</if>
		<if test="sampnm!=null and sampnm!=''">
			 and d.sampnm like '%${sampnm}%'
		</if>	 
		GROUP BY A.ORMTNO,E1.ITNM,E2.ITNM,D.SAMPNO,D.SAMPNM,C.SUITNO
		)M 
		LEFT JOIN ORD_COMP_PAL P ON M.ORMTNO=P.ORMTNO AND M.SAMPNO=P.SAMPNO
		LEFT JOIN ORD_SAMPLE_DESIGN P1 ON P.SAMPNO=P1.SAMPNO
     </select>
     <!--对订单明细表的确认数量清0-->
     <update id="clearnum_orddtl" parameterType="string">
     	update ORD_ORDDTL set ORMTQS=ORMTQT,ORMTQT=0 where sampno=#{sampno}
     </update>
     <!--对订单规格明细表的确认数量清0-->
     <update id="clearnum_ordszdtl" parameterType="string">
     	update ORD_ORDSZDTL set ORSZQT=0,ORBGQT=0,ORITQT=0 where sampno=#{sampno}
     </update>
     <!--获取某个样衣编号按照营销公司的汇总数据-->
     <select id="query_meger_comp" resultType="map" parameterType="string">
     	select C.YXGSNO,c.YXGSNM,B.SAMPNO,SUM(B.ORMTQT) ORMTQT from
		ORD_ORD a,ORD_ORDDTL b,V_ORD_ORG c
		where a.MTORNO=b.MTORNO and a.ORDORG=c.orgno and b.SAMPNO=#{SAMPNO}
		GROUP BY C.YXGSNO,c.YXGSNM,B.SAMPNO
     </select>
     
     <!--查询某个规格组的内容,sztype==1:规格上报，sztype==2：包装箱上报-->
     <select id="sizeVO_querySizeVOColumns" resultType="map" parameterType="string">
     	select a.sizety,a.sizeno,b.sizenm from ORD_PUB_SIZEDTL a ,ORD_PUB_SIZE b
		where  a.sizety=b.sizety and a.sizeno=b.sizeno  and 
		a.fszty='PRDSZTY' and a.fszno=#{sizegp} 
		<if test="sztype==1">
			and a.sizety='STDSZ'
		</if>
		order by a.sizety desc,a.sizeno
		
     </select>
     
      <select id="sizeVO_querySizeVOData" resultType="map" parameterType="string">
      		select x.*,y.SIZETY,y.SIZENO,y.ORSZQT,y.ORBGQT from (
			     select a.SPTYNO,a.SPSENO,b.VERSNO,a.PLSPNO,a.PLSPNM,b.SAMPNO,b.SAMPNM,d.ORMTQT
				from  ORD_SAMPLE_PLAN a,ORD_SAMPLE_DESIGN b,ORD_SAMPLE_DESIGN_SIZEGP c,ORD_ORDDTL d
				where a.plspno=b.plspno and b.sampno=c.sampno and c.sampno=d.sampno and c.suitno=d.suitno 
			       and c.suitno='T00' and a.ormtno='201605'  AND A.BRADNO='Y' and a.spclno='01' and c.sizegp='121'
			       and d.mtorno='201605_DZ_QY0003'
			 ) x left join (
				 select b.sampno,c.SIZETY,c.SIZENO,c.ORSZQT,c.ORBGQT
				 from ORD_ORDHD a,ORD_ORDDTL b,ORD_ORDSZDTL c
				 where a.MTORNO=b.MTORNO and a.MTORNO=c.MTORNO and b.SAMPNO=c.SAMPNO and b.SUITNO=c.Suitno
				       and a.MLORNO=b.MLORNO and a.MLORVN=b.MLORVN 
				 and b.suitno='T00'  -- and a.ormtno='201605'  and a.ORTYNO='DZ' and a.ordorg='QY0003'
				 AND a.BRADNO='Y' and a.SPCLNO='01'
				 and a.mtorno='201605_DZ_QY0003' and a.SDTYNO='20'
			 ) y on x.sampno=y.sampno
			 ORDER by x.sampno
      </select>
      
      
      
      
     <select id="ordMgr_queryOrdMgr" resultType="map" parameterType="map">
       	 select a.ORTYNO,c.YXGSNM,c.QYNM,c.ORGNM AS ORDORG_NAME,a.ORDORG,a.CHANNO,b.MLORNO,b.MLORVN,b.ISFECT,b.SDTYNO,b.BRADNO,b.SPCLNO,b.ORAPDP,b.ORSTAT,b.SZSTAT,b.ORAPDT
		 from ORD_ORD a,ORD_ORDHD b,v_ord_org c
		 where a.MTORNO=b.MTORNO and a.ordorg=c.orgno
       	 and a.ormtno=#{ormtno}   and c.yxgsno=#{yxgsno}   and c.qyno=#{qyno}   and a.channo=#{channo}   
       	 and b.bradno=#{bradno} and b.spclno=#{spclno} 
       	 <if test="ordorg!=null and ordorg!=''">
       	 	and a.ordorg=#{ordorg} 
       	 </if>
       	 <if test="ortyno!=null and ortyno!=''">
       	 	and a.ortyno=#{ortyno}
       	 </if>
       	 <if test=" orstat!=null and orstat!=''">
       	 	 and b.orstat=#{orstat}
       	 </if>
       	 <if test=" szstat!=null and szstat!=''">
       	 	 and b.szstat=#{szstat}
       	 </if>
       	 <if test=" isfect!=null and isfect!=''">
       	 	and b.isfect=#{isfect}
       	 </if>
     </select>
     
     <!--  不拆套 男套西  ：标准 ，裤子     (裤子<=nvl(配置值,15%) *标准) -->
     <select id="check_S10_Z0_0" resultType="map" parameterType="map">
     	select b.sampnm
		,sum(decode(a.suitno,'T00',ormtqt,0)) T00_ormtqt
		,sum(decode(a.suitno,'T02',ormtqt,0)) T02_ormtqt
		from ORD_ORDDTL a,ord_sample_design b,ord_sample_plan c
		where a.sampno=b.sampno and b.plspno=c.plspno and a.mtorno=#{mtorno}
		and c.sptyno='S10' and b.sexno='Z0' and b.spltmk=0
		group by b.sampnm
     </select>
     <!--   拆套男套西   ：上衣，裤子         (上衣=<裤子<=nvl(1+配置值,115% )*上衣) -->
     <select id="check_S10_Z0_1" resultType="map" parameterType="map">
     	select b.sampno,b.sampnm
		,sum(decode(a.suitno,'T00',ormtqt,0)) T00_ormtqt
		,sum(decode(a.suitno,'T01',ormtqt,0)) T01_ormtqt
		,sum(decode(a.suitno,'T02',ormtqt,0)) T02_ormtqt
		from ORD_ORDDTL a,ord_sample_design b,ord_sample_plan c
		where a.sampno=b.sampno and b.plspno=c.plspno and a.mtorno=#{mtorno}
		and c.sptyno='S10' and b.sexno='Z0' and b.spltmk=1
		group by  b.sampno,b.sampnm
     </select>
     <!-- 女 套西：上衣，裤子，裙子      (上衣=裤子=裙子) -->
     <select id="check_S10_Z1" resultType="map" parameterType="map">
     	select b.sampno,b.sampnm
		,sum(decode(a.suitno,'T00',ormtqt,0)) T00_ormtqt
		,sum(decode(a.suitno,'T01',ormtqt,0)) T01_ormtqt
		,sum(decode(a.suitno,'T02',ormtqt,0)) T02_ormtqt
		,sum(decode(a.suitno,'T04',ormtqt,0)) T04_ormtqt
		from ORD_ORDDTL a,ord_sample_design b,ord_sample_plan c
		where a.sampno=b.sampno and b.plspno=c.plspno and a.mtorno=#{mtorno}
		and c.sptyno='S10' and b.sexno='Z1' 
		group by  b.sampno,b.sampnm
     </select>
</mapper>

